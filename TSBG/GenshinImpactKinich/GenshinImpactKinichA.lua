-- PLEASE LOADSTRING GENSHINIMPACTKINICHB.LUA INSTEAD OF THIS UNLESS YOU WANT TO USE THE MOVESET DIRECTLY
task.wait(1)
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local hotbarFrame = playerGui:WaitForChild("Hotbar"):WaitForChild("Backpack"):WaitForChild("Hotbar")

local function setMoveName(slot, moveName)
    local baseButton = hotbarFrame:WaitForChild(slot).Base
    baseButton.ToolName.Text = moveName
end

setMoveName("1", "Grapple Yank")
setMoveName("2", "Ajawnado (NOT WORK)")
setMoveName("3", "Swordslam")
setMoveName("4", "Swing Push")

-- Scripts for the moves to be ran
local function move1()
    local ts = game:GetService("TweenService")
    local plrs = game:GetService("Players")
    local plr = plrs.LocalPlayer
    local char = plr.Character or plr.CharacterAdded:Wait()
    
    local trailsize = 1.5
    local a1pos = Vector3.new((trailsize / 2), 0, 0)
    local a2pos = Vector3.new(-(trailsize / 2), 0, 0)

    local lifetime = 0.5 -- to be changed
    local texture = "rbxassetid://88226740955738"

    local hook = Instance.new("Part", workspace)
    local trail = Instance.new("Trail", hook)
    local a1 = Instance.new("Attachment", hook)
    local a2 = Instance.new("Attachment", hook)
    a1.Position = a1pos
    a2.Position = a2pos
    trail.Attachment0 = a1
    trail.Attachment1 = a2
    trail.Brightness = 1
    trail.Color = ColorSequence.new(Color3.fromRGB(105, 255, 82))
    trail.FaceCamera = true
    trail.LightEmission = 1
    trail.LightInfluence = 0.5
    trail.Texture = texture
    trail.TextureLength = 1
    trail.TextureMode = Enum.TextureMode.Wrap
    trail.Transparency = NumberSequence.new(0.5)
    trail.Enabled = true
    trail.Lifetime = lifetime
    trail.WidthScale = NumberSequence.new(0.5)
    
    hook.Anchored = true
    hook.Position = char["Right Arm"].Position
    hook.Size = Vector3.new(0.5, 0.5, 0.5)
    hook.Transparency = 1
    
    local raycast = workspace:Raycast(char.HumanoidRootPart.Position, char.HumanoidRootPart.CFrame.LookVector * 50)
    local hit
    if raycast then
        if raycast.Instance:IsA("Terrain") then return end
        hit = raycast.Instance
        
        if hit.Name == "HumanoidRootPart" or hit.Parent:FindFirstChild("HumanoidRootPart") then
            local to
            if hit.Name == "HumanoidRootPart" then 
                to = hit 
            elseif hit.Parent:FindFirstChild("HumanoidRootPart") then 
                to = hit.Parent.HumanoidRootPart 
            end
            local tweeninfo = TweenInfo.new(lifetime, Enum.EasingStyle.Exponential)
            local goal = {
                Position = hit.Position
            }
            ts:Create(hook, tweeninfo, goal):Play()
            
            wait(lifetime)
            
            tweeninfo = TweenInfo.new(lifetime, Enum.EasingStyle.Exponential)
            goal = {
                Position = char["Right Arm"].Position
            }
            ts:Create(hook, tweeninfo, goal):Play()
            
        end
        
    end
end

local function move2()
    print("whyyy!!! I told u this is definitely not working!!!")
end

local function move3()
    local is = game:GetService("InsertService")
    local ts = game:GetService("TweenService")
    
    local asset = 9858163838
    
    local success, asset2 = pcall(function()
        return is:LoadAsset(asset)
    end)

    local model
    if success and asset2 then
        model = asset2
    else
        warn("Model could not load!")
    end

    local plr = game.Players.LocalPlayer
    local char = plr.Character or plr.CharacterAdded:Wait()
    
    local tool = Instance.new("Tool")
    model.Handle.Parent = tool
    model.Parts.Parent = tool
    tool.Parent = char

    for _, v in pairs(tool:GetDescendants()) do
        if v:IsA("Model") then return end
        v.Transparency = 1
        
        local tweeninfo = TweenInfo.new(0.1, Enum.EasingStyle.Linear, Enum.EasingDirection.Out, 0, false, 0)
        local goal = {
            Transparency = 0
        }
        local tween = ts:Create(v, tweeninfo, goal)
        tween:Play()
        
        -- Edit later for better
    end
end

local function move4()
    return
end

-- Set Ultimate Name
local function setUltimateName()
    local screenGui = playerGui:FindFirstChild("ScreenGui")
    local magicHealthFrame = screenGui and screenGui:FindFirstChild("MagicHealth")
    local textLabel = magicHealthFrame and magicHealthFrame:FindFirstChild("TextLabel")
    if textLabel then
        textLabel.Text = "Deal's A Deal"
    end
end

playerGui.DescendantAdded:Connect(setUltimateName)
setUltimateName()

-- Simplified Animation Functions
local function stopCurrentAnimations(humanoid)
    for _, animTrack in pairs(humanoid:GetPlayingAnimationTracks()) do
        animTrack:Stop()
    end
end

local function playAnimation(humanoid, animationId, speed, startTime, duration)
    stopCurrentAnimations(humanoid)
    
    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. animationId
    local track = humanoid:LoadAnimation(anim)
    
    track:Play()
    track:AdjustSpeed(speed or 1)
    track.TimePosition = startTime or 0

    if duration then
        delay(duration, function() track:Stop() end)
    end
end

-- List of Move Animations with Replacement IDs
-- 16139108718, 16139402582
-- 16515850153
-- 16431491215
-- 16597322398, 16597912086
local animations = {
    {id = "16139108718", replacement = "83903314470592", speed = 1, startTime = 0}, -- Move 1
    {id = "16515850153", replacement = "10466974801", speed = 1},                   -- Move 2
    {id = "16597322398", replacement = "10471336738", speed = 1},                   -- Move 3
    {id = "16597322398", replacement = "12510170989", speed = 1},                   -- Move 4
    {id = "16597912086", replacement = "74239279798426", speed = 1},                -- Move 4 var.2
    {id = "15955393872", replacement = "15955393873", speed = 1, startTime = 0.05}, -- Wall Combo
    {id = "12447707844", replacement = "12447707845", speed = 1},                   -- Ult Activation
    {id = "10479335397", replacement = "10479335398", speed = 1.3, duration = 1.8}, -- Dash
    {id = "10503381238", replacement = "122055502033440", speed = 0.7, startTime = 1.3}, -- Uppercut
    {id = "10470104242", replacement = "93870740117306", speed = 6, startTime = 0, duration = 0.2} -- Downslam
    {id = "00000000000", replacement = "000000000000", speed = 1}                   -- Idle (id will not be used)
}

-- Connect Animations to Play
local function onAnimationPlayed(animationTrack, humanoid)
    for i, anim in ipairs(animations) do
        if animationTrack.Animation.AnimationId == "rbxassetid://" .. anim.id then
            playAnimation(humanoid, anim.replacement, anim.speed, anim.startTime, anim.duration)
            if i == 1 then move1() end
            if i == (2 + 0) then move2() end
            if i == (3 + 0) then move3() end
            if i == (4 + 0) then move4() end
        end
    end
end

-- Hooking up animations
local humanoid = player.Character:WaitForChild("Humanoid")
humanoid.AnimationPlayed:Connect(function(animationTrack) onAnimationPlayed(animationTrack, humanoid) end)
local hrp = player.Character:WaitForChild("HumanoidRootPart")
hrp.Changed:Connect(function(property)
    if property == "Velocity" and hrp.Velocity <= 0 then
        local function 5050() return math.random(1, 2) == 1 end
        
        if 5050() then playAnimation(humanoid, animations[11]) end
        wait(10)
        
    end
end)

-- Punch animations with replacement
local punchAnimations = {
    ["17859015788"] = "12684185971",
    ["10469493270"] = "17889458563",
    ["10469630950"] = "17889461810",
    ["10469639222"] = "17889471098",
    ["10469643643"] = "17889290569",
    ["11365563255"] = "14516273501"
}

local function replacePunchAnimation(animationTrack)
    local replacementId = punchAnimations[animationTrack.Animation.AnimationId:match("%d+")]
    if replacementId then
        stopCurrentAnimations(humanoid)
        playAnimation(humanoid, replacementId)
    end
end

humanoid.AnimationPlayed:Connect(replacePunchAnimation)

-- Body Velocity Adjustment
local function adjustBodyVelocity(descendant)
    if descendant:IsA("BodyVelocity") then
        descendant.Velocity = Vector3.new(descendant.Velocity.X, 0, descendant.Velocity.Z)
    end
end

-- Apply adjustment to new character parts
local character = player.Character or player.CharacterAdded:Wait()
character.DescendantAdded:Connect(adjustBodyVelocity)
for _, desc in pairs(character:GetDescendants()) do
    adjustBodyVelocity(desc)
end

player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    character.DescendantAdded:Connect(adjustBodyVelocity)
    for _, desc in pairs(character:GetDescendants()) do
        adjustBodyVelocity(desc)
    end
end)
